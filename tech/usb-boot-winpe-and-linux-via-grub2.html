<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 6.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/favicon-64x64-dragon.jpg">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-64x64-dragon.jpg">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-64x64-dragon.jpg">
  <link rel="mask-icon" href="/images/favicon-64x64-dragon.jpg" color="#222">
  <meta name="google-site-verification" content="-QMh-gRPduq5T_vg3_Pwi3kZsNSiyuEpPBaDIXV8J34">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" integrity="sha256-HtsXJanqjKTc8vVQjO4YMhiqFoXkfBsjBWcX91T1jr8=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"oscarcx.com","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.18.1","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12},"copycode":{"enable":false,"style":null},"fold":{"enable":true,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":true,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"}}</script><script src="/js/config.js"></script>


  <style type="text/css">

div.hcb-content.hcb-block.hcbnote, details.hcb-content.box.hcbnote,div.hcb-content.hcb-block.hcbabstract, details.hcb-content.box.hcbabstract,div.hcb-content.hcb-block.hcbinfo, details.hcb-content.box.hcbinfo,div.hcb-content.hcb-block.hcbtip, details.hcb-content.box.hcbtip,div.hcb-content.hcb-block.hcbsuccess, details.hcb-content.box.hcbsuccess,div.hcb-content.hcb-block.hcbquestion, details.hcb-content.box.hcbquestion,div.hcb-content.hcb-block.hcbwarning, details.hcb-content.box.hcbwarning,div.hcb-content.hcb-block.hcbfailure, details.hcb-content.box.hcbfailure,div.hcb-content.hcb-block.hcbdanger, details.hcb-content.box.hcbdanger,div.hcb-content.hcb-block.hcbbug, details.hcb-content.box.hcbbug,div.hcb-content.hcb-block.hcbexample, details.hcb-content.box.hcbexample,div.hcb-content.hcb-block.hcbquote, details.hcb-content.box.hcbquote {
  border: .05rem solid #448aff;
  border-radius: .2rem;
  font-size: 0.96rem;
  margin: 1.5625em 0;
  padding: 0 1.2rem;
  transition: box-shadow 250ms;
}
div.hcb-content.hcb-block.hcbnote, details.hcb-content.box.hcbnote {
  border-color: #448aff;
}
div.hcb-content.hcb-block.hcbabstract, details.hcb-content.box.hcbabstract {
  border-color: #00b0ff;
}
div.hcb-content.hcb-block.hcbinfo, details.hcb-content.box.hcbinfo {
  border-color: #00b8d4;
}
div.hcb-content.hcb-block.hcbtip, details.hcb-content.box.hcbtip {
  border-color: #00bfa5;
}
div.hcb-content.hcb-block.hcbsuccess, details.hcb-content.box.hcbsuccess {
  border-color: #00c853;
}
div.hcb-content.hcb-block.hcbquestion, details.hcb-content.box.hcbquestion {
  border-color: #64dd17;
}
div.hcb-content.hcb-block.hcbwarning, details.hcb-content.box.hcbwarning {
  border-color: #ff9100;
}
div.hcb-content.hcb-block.hcbfailure, details.hcb-content.box.hcbfailure {
  border-color: #ff5252;
}
div.hcb-content.hcb-block.hcbdanger, details.hcb-content.box.hcbdanger {
  border-color: #ff1744;
}
div.hcb-content.hcb-block.hcbbug, details.hcb-content.box.hcbbug {
  border-color: #f50057;
}
div.hcb-content.hcb-block.hcbexample, details.hcb-content.box.hcbexample {
  border-color: #7c4dff;
}
div.hcb-content.hcb-block.hcbquote, details.hcb-content.box.hcbquote {
  border-color: #9e9e9e;
}
div.hcb-content.hcb-block.hcbnote:focus-within, details.hcb-content.box.hcbnote:focus-within {
  box-shadow: 0 0 0 .2rem #448aff1a;
}
div.hcb-content.hcb-block.hcbabstract:focus-within, details.hcb-content.box.hcbabstract:focus-within {
  box-shadow: 0 0 0 .2rem #00b0ff1a;
}
div.hcb-content.hcb-block.hcbinfo:focus-within, details.hcb-content.box.hcbinfo:focus-within {
  box-shadow: 0 0 0 .2rem #00b8d41a;
}
div.hcb-content.hcb-block.hcbtip:focus-within, details.hcb-content.box.hcbtip:focus-within {
  box-shadow: 0 0 0 .2rem #00bfa51a;
}
div.hcb-content.hcb-block.hcbsuccess:focus-within, details.hcb-content.box.hcbsuccess:focus-within {
  box-shadow: 0 0 0 .2rem #00c8531a;
}
div.hcb-content.hcb-block.hcbquestion:focus-within, details.hcb-content.box.hcbquestion:focus-within {
  box-shadow: 0 0 0 .2rem #64dd171a;
}
div.hcb-content.hcb-block.hcbwarning:focus-within, details.hcb-content.box.hcbwarning:focus-within {
  box-shadow: 0 0 0 .2rem #ff91001a;
}
div.hcb-content.hcb-block.hcbfailure:focus-within, details.hcb-content.box.hcbfailure:focus-within {
  box-shadow: 0 0 0 .2rem #ff52521a;
}
div.hcb-content.hcb-block.hcbdanger:focus-within, details.hcb-content.box.hcbdanger:focus-within {
  box-shadow: 0 0 0 .2rem #ff17441a;
}
div.hcb-content.hcb-block.hcbbug:focus-within, details.hcb-content.box.hcbbug:focus-within {
  box-shadow: 0 0 0 .2rem #f500571a;
}
div.hcb-content.hcb-block.hcbexample:focus-within, details.hcb-content.box.hcbexample:focus-within {
  box-shadow: 0 0 0 .2rem #7c4dff1a;
}
div.hcb-content.hcb-block.hcbquote:focus-within, details.hcb-content.box.hcbquote:focus-within {
  box-shadow: 0 0 0 .2rem #9e9e9e1a;
}
div.hcb-content.hcb-block.hcbnote *, details.hcb-content.box.hcbnote *,div.hcb-content.hcb-block.hcbabstract *, details.hcb-content.box.hcbabstract *,div.hcb-content.hcb-block.hcbinfo *, details.hcb-content.box.hcbinfo *,div.hcb-content.hcb-block.hcbtip *, details.hcb-content.box.hcbtip *,div.hcb-content.hcb-block.hcbsuccess *, details.hcb-content.box.hcbsuccess *,div.hcb-content.hcb-block.hcbquestion *, details.hcb-content.box.hcbquestion *,div.hcb-content.hcb-block.hcbwarning *, details.hcb-content.box.hcbwarning *,div.hcb-content.hcb-block.hcbfailure *, details.hcb-content.box.hcbfailure *,div.hcb-content.hcb-block.hcbdanger *, details.hcb-content.box.hcbdanger *,div.hcb-content.hcb-block.hcbbug *, details.hcb-content.box.hcbbug *,div.hcb-content.hcb-block.hcbexample *, details.hcb-content.box.hcbexample *,div.hcb-content.hcb-block.hcbquote *, details.hcb-content.box.hcbquote * {
  box-sizing: border-box;
}
div.hcb-content.hcb-block.hcbnote > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbnote > summary,div.hcb-content.hcb-block.hcbabstract > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbabstract > summary,div.hcb-content.hcb-block.hcbinfo > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbinfo > summary,div.hcb-content.hcb-block.hcbtip > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbtip > summary,div.hcb-content.hcb-block.hcbsuccess > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbsuccess > summary,div.hcb-content.hcb-block.hcbquestion > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbquestion > summary,div.hcb-content.hcb-block.hcbwarning > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbwarning > summary,div.hcb-content.hcb-block.hcbfailure > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbfailure > summary,div.hcb-content.hcb-block.hcbdanger > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbdanger > summary,div.hcb-content.hcb-block.hcbbug > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbbug > summary,div.hcb-content.hcb-block.hcbexample > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbexample > summary,div.hcb-content.hcb-block.hcbquote > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbquote > summary {
  border-top-right-radius: 0.1rem;
  border-top-left-radius: 0.1rem;
  border-left-width: 0.2rem;
  display: block;
  min-height: 1rem;
  border: none;
  font-weight: 700;
  margin: 0 -1.2rem 1rem;
  padding: 0.4rem 0.6rem;
  position: relative;
  outline: none;
}
details.hcb-content.box.hcbnote > summary,details.hcb-content.box.hcbabstract > summary,details.hcb-content.box.hcbinfo > summary,details.hcb-content.box.hcbtip > summary,details.hcb-content.box.hcbsuccess > summary,details.hcb-content.box.hcbquestion > summary,details.hcb-content.box.hcbwarning > summary,details.hcb-content.box.hcbfailure > summary,details.hcb-content.box.hcbdanger > summary,details.hcb-content.box.hcbbug > summary,details.hcb-content.box.hcbexample > summary,details.hcb-content.box.hcbquote > summary {
  cursor: pointer;
}
details.hcb-content.box.hcbnote:not([open]) > summary,details.hcb-content.box.hcbabstract:not([open]) > summary,details.hcb-content.box.hcbinfo:not([open]) > summary,details.hcb-content.box.hcbtip:not([open]) > summary,details.hcb-content.box.hcbsuccess:not([open]) > summary,details.hcb-content.box.hcbquestion:not([open]) > summary,details.hcb-content.box.hcbwarning:not([open]) > summary,details.hcb-content.box.hcbfailure:not([open]) > summary,details.hcb-content.box.hcbdanger:not([open]) > summary,details.hcb-content.box.hcbbug:not([open]) > summary,details.hcb-content.box.hcbexample:not([open]) > summary,details.hcb-content.box.hcbquote:not([open]) > summary {
  margin-bottom: 0;
}
div.hcb-content.hcb-block.hcbnote > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbnote > summary {
  background-color: #448aff1a;
}
div.hcb-content.hcb-block.hcbabstract > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbabstract > summary {
  background-color: #00b0ff1a;
}
div.hcb-content.hcb-block.hcbinfo > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbinfo > summary {
  background-color: #00b8d41a;
}
div.hcb-content.hcb-block.hcbtip > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbtip > summary {
  background-color: #00bfa51a;
}
div.hcb-content.hcb-block.hcbsuccess > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbsuccess > summary {
  background-color: #00c8531a;
}
div.hcb-content.hcb-block.hcbquestion > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbquestion > summary {
  background-color: #64dd171a;
}
div.hcb-content.hcb-block.hcbwarning > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbwarning > summary {
  background-color: #ff91001a;
}
div.hcb-content.hcb-block.hcbfailure > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbfailure > summary {
  background-color: #ff52521a;
}
div.hcb-content.hcb-block.hcbdanger > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbdanger > summary {
  background-color: #ff17441a;
}
div.hcb-content.hcb-block.hcbbug > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbbug > summary {
  background-color: #f500571a;
}
div.hcb-content.hcb-block.hcbexample > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbexample > summary {
  background-color: #7c4dff1a;
}
div.hcb-content.hcb-block.hcbquote > p.hcb-content.hcb-block-title, details.hcb-content.box.hcbquote > summary {
  background-color: #9e9e9e1a;
}
div.hcb-content.hcb-block.hcbnote > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbnote > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #448aff;
}
div.hcb-content.hcb-block.hcbabstract > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbabstract > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #00b0ff;
}
div.hcb-content.hcb-block.hcbinfo > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbinfo > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #00b8d4;
}
div.hcb-content.hcb-block.hcbtip > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbtip > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #00bfa5;
}
div.hcb-content.hcb-block.hcbsuccess > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbsuccess > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #00c853;
}
div.hcb-content.hcb-block.hcbquestion > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbquestion > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #64dd17;
}
div.hcb-content.hcb-block.hcbwarning > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbwarning > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #ff9100;
}
div.hcb-content.hcb-block.hcbfailure > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbfailure > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #ff5252;
}
div.hcb-content.hcb-block.hcbdanger > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbdanger > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #ff1744;
}
div.hcb-content.hcb-block.hcbbug > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbbug > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #f50057;
}
div.hcb-content.hcb-block.hcbexample > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbexample > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #7c4dff;
}
div.hcb-content.hcb-block.hcbquote > p.hcb-content.hcb-block-title > i, details.hcb-content.box.hcbquote > summary > i {
  margin: 0 0.6rem 0 0.6rem;
  color: #9e9e9e;
}
details.hcb-content.box.hcbnote > summary > div.hcb-box-open-button,details.hcb-content.box.hcbabstract > summary > div.hcb-box-open-button,details.hcb-content.box.hcbinfo > summary > div.hcb-box-open-button,details.hcb-content.box.hcbtip > summary > div.hcb-box-open-button,details.hcb-content.box.hcbsuccess > summary > div.hcb-box-open-button,details.hcb-content.box.hcbquestion > summary > div.hcb-box-open-button,details.hcb-content.box.hcbwarning > summary > div.hcb-box-open-button,details.hcb-content.box.hcbfailure > summary > div.hcb-box-open-button,details.hcb-content.box.hcbdanger > summary > div.hcb-box-open-button,details.hcb-content.box.hcbbug > summary > div.hcb-box-open-button,details.hcb-content.box.hcbexample > summary > div.hcb-box-open-button,details.hcb-content.box.hcbquote > summary > div.hcb-box-open-button {
  float: right;
}
details.hcb-content.box.hcbnote > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbabstract > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbinfo > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbtip > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbsuccess > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbquestion > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbwarning > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbfailure > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbdanger > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbbug > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbexample > summary > div.hcb-box-open-button > i,details.hcb-content.box.hcbquote > summary > div.hcb-box-open-button > i {
  margin: 0 0.6rem 0 0.6rem;
  font-size: 0.7rem;
  transition: transform 250ms
}
details.hcb-content.box.hcbnote:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbabstract:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbinfo:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbtip:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbsuccess:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbquestion:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbwarning:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbfailure:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbdanger:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbbug:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbexample:not([open]) > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbquote:not([open]) > summary > div.hcb-box-open-button i {
  transform: rotate(270deg);
}
details.hcb-content.box.hcbnote[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbabstract[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbinfo[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbtip[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbsuccess[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbquestion[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbwarning[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbfailure[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbdanger[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbbug[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbexample[open] > summary > div.hcb-box-open-button i,details.hcb-content.box.hcbquote[open] > summary > div.hcb-box-open-button i {
  transform: rotate(180deg);
}
details.hcb-content.box.hcbnote summary div.hcb-box-open-button i {
  color: #448aff;
}
details.hcb-content.box.hcbabstract summary div.hcb-box-open-button i {
  color: #00b0ff;
}
details.hcb-content.box.hcbinfo summary div.hcb-box-open-button i {
  color: #00b8d4;
}
details.hcb-content.box.hcbtip summary div.hcb-box-open-button i {
  color: #00bfa5;
}
details.hcb-content.box.hcbsuccess summary div.hcb-box-open-button i {
  color: #00c853;
}
details.hcb-content.box.hcbquestion summary div.hcb-box-open-button i {
  color: #64dd17;
}
details.hcb-content.box.hcbwarning summary div.hcb-box-open-button i {
  color: #ff9100;
}
details.hcb-content.box.hcbfailure summary div.hcb-box-open-button i {
  color: #ff5252;
}
details.hcb-content.box.hcbdanger summary div.hcb-box-open-button i {
  color: #ff1744;
}
details.hcb-content.box.hcbbug summary div.hcb-box-open-button i {
  color: #f50057;
}
details.hcb-content.box.hcbexample summary div.hcb-box-open-button i {
  color: #7c4dff;
}
details.hcb-content.box.hcbquote summary div.hcb-box-open-button i {
  color: #9e9e9e;
}
div.hcb-content.hcb-cards * {
  box-sizing: border-box;
}
input.hcb-content.hcb-cards-input {
  display: none;
}
div.hcb-content.hcb-cards-labels {
  position: relative;
  box-shadow: 0 -0.05rem #00000012 inset;
  display: flex;
  margin-bottom: 1.25rem;
}
div.hcb-content.hcb-cards-labels:before {
  background: var(--cards-color);
  bottom: 0;
  content: "";
  display: block;
  height: 2px;
  left: 0;
  position: absolute;
  transform: translateX(var(--md-indicator-x));
  transition: width 225ms, transform 250ms;
  transition-timing-function: cubic-bezier(.4,0,.2,1);
  width: var(--md-indicator-width);
}
label.hcb-content.hcb-cards-label {
  border-bottom: 0.1rem solid #0000;
  border-radius: 0.1rem 0.1rem 0 0;
  cursor: pointer;
  color: #0000008a;
  font-size: 0.92em;
  font-weight: 700;
  padding: 0 1.25rem 0.625rem;
  transition: color 250ms;
}
label.hcb-content.hcb-cards-label.active, label.hcb-content.hcb-cards-label:hover {
  color: var(--cards-color);
}
div.hcb-content.hcb-cards-content {
  display: none;
}
div.hcb-content.hcb-cards-content.active {
  display: block;
}
</style>
    <meta name="description" content="我的U盘原本安装的是WEPE，用起来一直感觉不错，但是没法引导linux的livecd。我试图使用FbinstTool修改，但是改了半天好像也没生效，每次都是直接启动WEPE。无奈之下，只能开始折腾，看看有没有其它手段可以达成WinPE和Linux的多重引导。">
<meta property="og:type" content="article">
<meta property="og:title" content="用grub2制作多重引导的WinPE&amp;Linux启动U盘">
<meta property="og:url" content="https://oscarcx.com/tech/usb-boot-winpe-and-linux-via-grub2.html">
<meta property="og:site_name" content="Cow">
<meta property="og:description" content="我的U盘原本安装的是WEPE，用起来一直感觉不错，但是没法引导linux的livecd。我试图使用FbinstTool修改，但是改了半天好像也没生效，每次都是直接启动WEPE。无奈之下，只能开始折腾，看看有没有其它手段可以达成WinPE和Linux的多重引导。">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_1.png">
<meta property="og:image" content="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_2.png">
<meta property="og:image" content="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_3.png">
<meta property="og:image" content="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_4.png">
<meta property="og:image" content="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_5.png">
<meta property="article:published_time" content="2020-08-23T18:17:21.000Z">
<meta property="article:modified_time" content="2025-05-18T16:05:39.211Z">
<meta property="article:author" content="oscarcx123">
<meta property="article:tag" content="Linux">
<meta property="article:tag" content="grub2">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_1.png">


<link rel="canonical" href="https://oscarcx.com/tech/usb-boot-winpe-and-linux-via-grub2.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://oscarcx.com/tech/usb-boot-winpe-and-linux-via-grub2.html","path":"tech/usb-boot-winpe-and-linux-via-grub2.html","title":"用grub2制作多重引导的WinPE&Linux启动U盘"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>用grub2制作多重引导的WinPE&Linux启动U盘 | Cow</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style type="text/css">
.spoiler {
  display: inline;
}
p.spoiler {
  display: flex;
}
.spoiler a {
  pointer-events: none;
}
.spoiler-blur, .spoiler-blur > * {
  transition: text-shadow .5s ease;
}
.spoiler .spoiler-blur, .spoiler .spoiler-blur > * {
  color: rgba(0, 0, 0, 0);
  background-color: rgba(0, 0, 0, 0);
  text-shadow: 0 0 10px grey;
  cursor: pointer;
}
.spoiler .spoiler-blur:hover, .spoiler .spoiler-blur:hover > * {
  text-shadow: 0 0 5px grey;
}
.spoiler-box, .spoiler-box > * {
  transition: color .5s ease,
  background-color .5s ease;
}
.spoiler .spoiler-box, .spoiler .spoiler-box > * {
  color: black;
  background-color: black;
  text-shadow: none;
}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Cow</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
  </ul>
</nav>




</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#u%E7%9B%98%E5%88%86%E5%8C%BA"><span class="nav-number">1.</span> <span class="nav-text"> U盘分区</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AE%89%E8%A3%85grub2"><span class="nav-number">2.</span> <span class="nav-text"> 安装grub2</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%8E%B7%E5%8F%96wepeiso"><span class="nav-number">3.</span> <span class="nav-text"> 获取WEPE.iso</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%89%8B%E5%8A%A8%E5%AE%89%E8%A3%85wepe"><span class="nav-number">4.</span> <span class="nav-text"> 手动安装WEPE</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%AD%98%E6%94%BE%E5%85%B6%E5%AE%83iso"><span class="nav-number">5.</span> <span class="nav-text"> 存放其它iso</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#grubcfg"><span class="nav-number">6.</span> <span class="nav-text"> grub.cfg</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#grub%E4%B8%BB%E9%A2%98"><span class="nav-number">6.1.</span> <span class="nav-text"> grub主题</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9F%A5%E6%89%BEntfs%E5%88%86%E5%8C%BA"><span class="nav-number">6.2.</span> <span class="nav-text"> 查找ntfs分区</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#winpe"><span class="nav-number">6.3.</span> <span class="nav-text"> WinPE</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ubuntu"><span class="nav-number">6.4.</span> <span class="nav-text"> Ubuntu</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#arch-linux"><span class="nav-number">6.5.</span> <span class="nav-text"> Arch Linux</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%88%91%E7%9A%84grubcfg"><span class="nav-number">6.6.</span> <span class="nav-text"> 我的grub.cfg</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%B0%8F%E7%BB%93"><span class="nav-number">7.</span> <span class="nav-text"> 小结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%9C%80%E5%90%8E%E7%9A%84%E6%9C%80%E5%90%8E"><span class="nav-number">8.</span> <span class="nav-text"> 最后的最后</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="oscarcx123"
      src="/images/avatar.jpg">
  <p class="site-author-name" itemprop="name">oscarcx123</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">32</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">6</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/oscarcx123" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;oscarcx123" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://oscarcx.com/tech/usb-boot-winpe-and-linux-via-grub2.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.jpg">
      <meta itemprop="name" content="oscarcx123">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Cow">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="用grub2制作多重引导的WinPE&Linux启动U盘 | Cow">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          用grub2制作多重引导的WinPE&Linux启动U盘
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2020-08-23 18:17:21" itemprop="dateCreated datePublished" datetime="2020-08-23T18:17:21+00:00">2020-08-23</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/tech/" itemprop="url" rel="index"><span itemprop="name">技术</span></a>
        </span>
    </span>

  
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>2.3k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>8 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>我的U盘原本安装的是WEPE，用起来一直感觉不错，但是没法引导linux的livecd。我试图使用<code>FbinstTool</code>修改，但是改了半天好像也没生效，每次都是直接启动WEPE。无奈之下，只能开始折腾，看看有没有其它手段可以达成WinPE和Linux的多重引导。</p>
<span id="more"></span>
<p>最开始我试图弄明白WEPE的三合一引导是咋回事，可惜看完了<a target="_blank" rel="noopener" href="https://www.jianshu.com/p/2c18f053f5b0">分别使用U+、B+、UD制作WinPE启动盘</a>这篇文章还是云里雾里。在看教程的时候又无意间发现有个叫Xorboot的程序，可以同时引导Windows NT和Linux，但是又被论坛积分给挡住了。。。</p>
<p>后来我一想，我自己的笔记本是通过grub2来引导Manjaro和Windows的，为什么不试试强大的grub2呢？虽然我以前制作WinPE都是用那种一键傻瓜式制作的工具，对底层的东西完全不懂，但是现炒现卖应该也不成问题。因此在查阅了一大堆中文英文教程，奋战了几个小时之后，终于成功制作了启动盘。现在将制作过程记录下来，让后来人不用重复走弯路，当然也是免得我以后忘了，又得重新折腾。</p>
<h1 id="u盘分区"><a class="markdownIt-Anchor" href="#u盘分区"></a> U盘分区</h1>
<p>在进行下面的操作之前，务必要备份U盘内的数据！</p>
<p>这里使用<code>GParted</code>，毕竟图形界面还是非常直观的。如果非要用命令行分区，那<code>fdisk</code>、<code>gdisk</code>、<code>cfdisk</code>、<code>parted</code>也都可以胜任。这四个里头，个人感觉<code>cfdisk</code>应该是最容易上手的，因为它是图形化的命令行工具。</p>
<p>首先要把U盘上面所有的分区都删了，删完之后应该显示“未分配”（unallocated），如下所示</p>
<p><img src="https://oscarcx.com/hexo_resource/img/loading_cow.png" data-src="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_1.png" alt="" /></p>
<p>然后通过 Device &gt; Create Partition Table 来建立GPT分区表，这里选中<code>gpt</code>然后点<code>Apply</code>，如下所示</p>
<p><img src="https://oscarcx.com/hexo_resource/img/loading_cow.png" data-src="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_2.png" alt="" /></p>
<p>接下来建立分区，一般是建立一个比较小的<code>fat32</code>，只要能放得下winpe就可以了。因为我的U盘容量是128GB，所以我大手一挥就给了1GB，实际上500MB应该也绰绰有余了。当然，U盘剩下的空间就全部给<code>ntfs</code>，这样可以用来储存数据，并且能够在Windows系统读取。</p>
<p>分区之后会发现，此时还有1MB空间未分配，这个是<code>GParted</code>自动预留的，如下所示。</p>
<p><img src="https://oscarcx.com/hexo_resource/img/loading_cow.png" data-src="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_3.png" alt="" /></p>
<p>现在需要将其标记成BIOS boot partition（BIOS启动分区）。Arch Wiki在这里解释的通俗易懂，因此直接在下面引用原文。如果想了解更多，可以看<a target="_blank" rel="noopener" href="https://www.gnu.org/software/grub/manual/grub/html_node/BIOS-installation.html#BIOS-installation">GNU GRUB Manual 2.04: BIOS installation</a>。</p>
<blockquote>
<p>BIOS/GPT配置中，必须使用 BIOS 启动分区。GRUB将core.img嵌入到这个分区。此额外分区只由GRUB在BIOS/GPT分区方式中使用。对于BIOS/MBR分区方式，GRUB会把core.img放到MBR后面的间隙中去。而在GPT分区表中是不能保证在第一个分区之前有这样一个可以使用的间隙的。UEFI系统也不需要这额外分区，因为它不需要嵌入启动扇区。UEFI系统需要有EFI系统分区。</p>
</blockquote>
<p>然而<code>GParted</code>貌似无法给最后那个分区标记<code>bios_grub</code>，所以就用其它工具来完成。</p>
<p>万能的Arch Wiki上面给出了三种方法：</p>
<ul>
<li>对于<code>fdisk</code>，选择分区类型<code>BIOS boot</code>。</li>
<li>对于<code>gdisk</code>，选择分区类型代码<code>ef02</code>。</li>
<li>对于<code>parted</code>， 在新创建的分区上设置/激活<code>bios_grub</code>标记</li>
</ul>
<p>这里我用<code>gdisk</code>来完成，由于是交互式的环境，所以直接放上完整的交互结果。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="built_in">sudo</span> gdisk /dev/sdb</span><br><span class="line">GPT fdisk (gdisk) version 1.0.5</span><br><span class="line"></span><br><span class="line">Partition table scan:</span><br><span class="line">  MBR: protective</span><br><span class="line">  BSD: not present</span><br><span class="line">  APM: not present</span><br><span class="line">  GPT: present</span><br><span class="line"></span><br><span class="line">Found valid GPT with protective MBR; using GPT.</span><br><span class="line"></span><br><span class="line"><span class="comment"># n -&gt; add a new partition</span></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): n</span><br><span class="line"><span class="comment"># 下面这几个都直接回车</span></span><br><span class="line">Partition number (3-128, default 3): </span><br><span class="line">First sector (34-240254942, default = 240252928) or &#123;+-&#125;size&#123;KMGTP&#125;: </span><br><span class="line">Last sector (240252928-240254942, default = 240254942) or &#123;+-&#125;size&#123;KMGTP&#125;: </span><br><span class="line">Current <span class="built_in">type</span> is 8300 (Linux filesystem)</span><br><span class="line"><span class="comment"># 这里输入EF02</span></span><br><span class="line">Hex code or GUID (L to show codes, Enter = 8300): EF02</span><br><span class="line">Changed <span class="built_in">type</span> of partition to <span class="string">&#x27;BIOS boot partition&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p -&gt; print the partition table</span></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): p</span><br><span class="line">Disk /dev/sdb: 240254976 sectors, 114.6 GiB</span><br><span class="line">Model: Ultra USB 3.0   </span><br><span class="line">Sector size (logical/physical): 512/512 bytes</span><br><span class="line">Disk identifier (GUID): EC111A6E-8655-4C75-802C-170345DB3B0E</span><br><span class="line">Partition table holds up to 128 entries</span><br><span class="line">Main partition table begins at sector 2 and ends at sector 33</span><br><span class="line">First usable sector is 34, last usable sector is 240254942</span><br><span class="line">Partitions will be aligned on 2048-sector boundaries</span><br><span class="line">Total free space is 2014 sectors (1007.0 KiB)</span><br><span class="line"></span><br><span class="line">Number  Start (sector)    End (sector)  Size       Code  Name</span><br><span class="line">   1            2048        61442047   29.3 GiB    EF00  </span><br><span class="line">   2        61442048       240252927   85.3 GiB    0700  </span><br><span class="line">   3       240252928       240254942   1007.5 KiB  EF02  BIOS boot partition</span><br><span class="line"></span><br><span class="line"><span class="comment"># w -&gt; write table to disk and exit</span></span><br><span class="line">Command (? <span class="keyword">for</span> <span class="built_in">help</span>): w</span><br><span class="line"></span><br><span class="line">Final checks complete. About to write GPT data. THIS WILL OVERWRITE EXISTING PARTITIONS!!</span><br><span class="line"></span><br><span class="line">Do you want to proceed? (Y/N): y</span><br><span class="line">OK; writing new GUID partition table (GPT) to /dev/sdb.</span><br><span class="line">The operation has completed successfully.</span><br></pre></td></tr></table></figure>
<p>搞定之后，U盘的分区应该跟下面这个类似</p>
<p><img src="https://oscarcx.com/hexo_resource/img/loading_cow.png" data-src="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_4.png" alt="" /></p>
<h1 id="安装grub2"><a class="markdownIt-Anchor" href="#安装grub2"></a> 安装grub2</h1>
<p>首先挂载esp（EFI system partition）到<code>/mnt</code>，下面命令带参数就可以免root操作文件，会舒服很多。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sudo</span> mount /dev/sdb1 /mnt -o uid=<span class="variable">$USER</span>,gid=<span class="variable">$USER</span></span><br></pre></td></tr></table></figure>
<p>然后使用<code>grub-install</code>命令安装。因为是把grub安装到U盘上，所以需要带上<code>--removable</code>。这个命令需要一点时间才能执行完，所以耐心等一会儿。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$ sudo grub-install --target x86_64-efi --efi-directory /mnt --boot-directory=/mnt/boot --removable</span><br><span class="line">Installing for x86_64-efi platform.</span><br><span class="line">Installation finished. No error reported.</span><br></pre></td></tr></table></figure>
<h1 id="获取wepeiso"><a class="markdownIt-Anchor" href="#获取wepeiso"></a> 获取WEPE.iso</h1>
<p>WEPE官网只分发exe格式的一键安装器，我试图用wine运行，结果失败。无奈之下，还是开了个win10虚拟机来进行操作。</p>
<p>打开安装器之后，点击右下角的光盘图标，然后点击“立即生成ISO”，如下所示。</p>
<p><img src="https://oscarcx.com/hexo_resource/img/loading_cow.png" data-src="https://oscarcx.com/hexo_resource/img/usb_boot_winpe_and_linux_via_grub2_5.png" alt="" /></p>
<h1 id="手动安装wepe"><a class="markdownIt-Anchor" href="#手动安装wepe"></a> 手动安装WEPE</h1>
<p>此时U盘esp目录的挂载点是<code>/mnt</code>，这里需要进行下面操作：</p>
<ul>
<li>把/WEPE复制到<code>/mnt</code></li>
<li>把/EFI/MICROSOFT复制到<code>/mnt/EFI</code></li>
</ul>
<p>操作完之后，U盘的esp目录结构如下</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">/mnt</span><br><span class="line">├── boot</span><br><span class="line">│   └── grub</span><br><span class="line">├── EFI</span><br><span class="line">│   ├── BOOT</span><br><span class="line">│   └── MICROSOFT</span><br><span class="line">└── WEPE</span><br></pre></td></tr></table></figure>
<p>进入<code>BOOT</code>文件夹就会发现，里头只有BCD文件，还少一个<code>bootmgfw.efi</code>。我当时在安装Manjaro Linux的时候，留了一个30GB的win10来救急。因为Linux会自动把esp挂载到<code>/boot/efi</code>，所以直接在本机的esp分区 &gt; EFI &gt; Microsoft &gt; Boot就可以找到到<code>bootmgfw.efi</code>，最后复制到U盘的<code>BOOT</code>文件夹就行了。</p>
<h1 id="存放其它iso"><a class="markdownIt-Anchor" href="#存放其它iso"></a> 存放其它iso</h1>
<p>Linux的iso是不用解压就能直接引导的，所以直接存放在NTFS分区即可，甚至还可以分类摆放。Windows的iso是可以在WinPE里头直接安装的，所以也放在NTFS分区。下面给出示例结构。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">NTFS分区</span><br><span class="line">├── Linux</span><br><span class="line">│   ├── deepin-20Beta-desktop-amd64.iso</span><br><span class="line">│   ├── Fedora-Workstation-Live-x86_64-32-1.6.iso</span><br><span class="line">│   ├── manjaro-xfce-20.0.3-200606-linux56.iso</span><br><span class="line">│   └── ubuntu-20.04.1-desktop-amd64.iso</span><br><span class="line">├── Utils</span><br><span class="line">│   ├── clonezilla-live-2.6.7-28-amd64.iso</span><br><span class="line">│   └── gparted-live-1.1.0-5-amd64.iso</span><br><span class="line">└── Windows</span><br><span class="line">    ├── Win10_1903_V1_zh-CN_x64.iso</span><br><span class="line">    ├── Win7_ultimate_zh-CN_x64.iso</span><br><span class="line">    └── WinXP_SP3_EN_x86.iso</span><br></pre></td></tr></table></figure>
<h1 id="grubcfg"><a class="markdownIt-Anchor" href="#grubcfg"></a> grub.cfg</h1>
<p>grub的配置文件就五花八门了，一般都是自己拼凑，再加上看文档，就能捣鼓出来。官方说明书可以看<a target="_blank" rel="noopener" href="https://www.gnu.org/software/grub/manual/grub/grub.html">GNU GRUB Manual 2.04</a>，英语水平不行的话，可以看<a target="_blank" rel="noopener" href="http://www.jinbuguo.com/linux/grub.cfg.html">GRUB2配置文件“grub.cfg”详解(GRUB2实战手册)</a></p>
<p>下面就提供一些可以依葫芦画瓢抄走的grub配置，我也在本文末尾提供了自用的<code>grub.cfg</code>，给各位参考。</p>
<h2 id="grub主题"><a class="markdownIt-Anchor" href="#grub主题"></a> grub主题</h2>
<p>grub自带了一套叫<code>starfield</code>的主题，在配置头部添加下面内容即可。</p>
<p>注意：<code>$prefix</code>就是<code>/boot/grub</code></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 主题配置</span><br><span class="line">set theme=$prefix/themes/starfield/theme.txt</span><br></pre></td></tr></table></figure>
<p>如果需要使用其他主题，可以自行修改theme变量指向的文件。</p>
<h2 id="查找ntfs分区"><a class="markdownIt-Anchor" href="#查找ntfs分区"></a> 查找ntfs分区</h2>
<p>grub默认只能找到esp，所以还需要通过uuid来找到之前设置的NTFS分区。这一步是必须做的，因为Linux iso全部存放在NTFS分区。</p>
<p>获取uuid可以用下面任意一种方法：</p>
<ul>
<li>GParted，右键选中分区，点击information</li>
<li>lsblk
<ul>
<li>lsblk -f（列出所有文件系统）</li>
<li>lsblk -dno UUID /dev/sdb2（输出/dev/sdb2的uuid）</li>
</ul>
</li>
<li>blkid（列出全部block device的属性）
<ul>
<li>blkid -s UUID -o value /dev/sdb2（输出/dev/sdb2的uuid）</li>
</ul>
</li>
</ul>
<p>然后按照下面这样写，自行替换下uuid。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set ntfs_uuid=&quot;7BB351DB761B4D10&quot;</span><br><span class="line">search --no-floppy --set=ntfs_part --fs-uuid $ntfs_uuid</span><br></pre></td></tr></table></figure>
<h2 id="winpe"><a class="markdownIt-Anchor" href="#winpe"></a> WinPE</h2>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">menuentry &quot;Windows PE&quot; --class=windows &#123;</span><br><span class="line">    chainloader /EFI/microsoft/boot/bootmgfw.efi</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="ubuntu"><a class="markdownIt-Anchor" href="#ubuntu"></a> Ubuntu</h2>
<p>这里给的例子是<code>Ubuntu 20.04</code>，其它Ubuntu版本（包括Xubuntu等各类衍生版）应该只需要修改<code>isofile</code>变量就可以了。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">menuentry &quot;Ubuntu 20.04.1 LTS (Focal Fossa)&quot;  --class=ubuntu &#123;</span><br><span class="line">    # 加载iso</span><br><span class="line">    set isofile=/iso/Linux/ubuntu-20.04.1-desktop-amd64.iso</span><br><span class="line">    loopback loop ($ntfs_part)$isofile</span><br><span class="line">    # 有独显进不去安装界面，在下面一行最后加上nomodeset</span><br><span class="line">    linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile quiet splash</span><br><span class="line">    # casper会创建一个可写环境（在livecd里头就可以安装软件）</span><br><span class="line">    initrd (loop)/casper/initrd</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>关于nomodeset，Ubuntu官方论坛的解释如下：</p>
<blockquote>
<p>The newest kernels have moved the video mode setting into the kernel. So all the programming of the hardware specific clock rates and registers on the video card happen in the kernel rather than in the X driver when the X server starts.. This makes it possible to have high resolution nice looking splash (boot) screens and flicker free transitions from boot splash to login screen. Unfortunately, on some cards this doesnt work properly and you end up with a black screen. Adding the nomodeset parameter instructs the kernel to not load video drivers and use BIOS modes instead until X is loaded.</p>
</blockquote>
<p>简单来说，添加nomodeset参数会让内核暂时不加载显卡驱动并使用BIOS模式，直到X11（X Window System）加载完毕。完整的解释可以看<a target="_blank" rel="noopener" href="https://ubuntuforums.org/showthread.php?t=1613132">How to set NOMODESET and other kernel boot options in grub2 - ubuntu forums</a></p>
<h2 id="arch-linux"><a class="markdownIt-Anchor" href="#arch-linux"></a> Arch Linux</h2>
<p>这里给的是Arch Wiki上的例子，看起来跟Ubuntu派系差别挺大的。Arch派系应该都可以参照这个改。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">menuentry &quot;Arch Linux x86_64 (2020.08.01)&quot; --class=arch &#123;</span><br><span class="line">	set isofile=&#x27;/iso/Linux/archlinux-2020.08.01-x86_64.iso&#x27;</span><br><span class="line">    set imgdevpath=&quot;/dev/disk/by-uuid/$ntfs_uuid&quot;</span><br><span class="line">	loopback loop ($ntfs_part)$isofile</span><br><span class="line">	linux (loop)/arch/boot/x86_64/vmlinuz-linux img_dev=$imgdevpath img_loop=$isofile earlymodules=loop</span><br><span class="line">	initrd (loop)/arch/boot/intel-ucode.img (loop)/arch/boot/amd-ucode.img (loop)/arch/boot/x86_64/archiso.img</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="我的grubcfg"><a class="markdownIt-Anchor" href="#我的grubcfg"></a> 我的grub.cfg</h2>
<p>最后送上懒人包，我的<code>grub.cfg</code>的menuentry全都测试过，确认没有问题，可以稍作替换后直接拿去用。其中isofile是从NTFS分区的根目录开始算的，如果跟我存放iso的位置不同，那就需要自行修改。</p>
<p>Fedora我目前搞不定，也懒得搞，好像本来就没什么人用。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line">set theme=$prefix/themes/starfield/theme.txt</span><br><span class="line"></span><br><span class="line">set ntfs_uuid=&quot;7BB351DB761B4D10&quot;</span><br><span class="line">search --no-floppy --set=ntfs_part --fs-uuid $ntfs_uuid</span><br><span class="line"></span><br><span class="line">menuentry &quot;Windows PE&quot; --class=windows &#123;</span><br><span class="line">    chainloader /EFI/microsoft/boot/bootmgfw.efi</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menuentry &quot;Ubuntu 20.04.1 LTS (Focal Fossa)&quot; --class=ubuntu &#123;</span><br><span class="line">    set isofile=/iso/Linux/ubuntu-20.04.1-desktop-amd64.iso</span><br><span class="line">    loopback loop ($ntfs_part)$isofile</span><br><span class="line">    linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile quiet splash</span><br><span class="line">    initrd (loop)/casper/initrd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menuentry &quot;Ubuntu 18.04.5 LTS (Bionic Beaver)&quot; --class=ubuntu &#123;</span><br><span class="line">    set isofile=/iso/Linux/ubuntu-18.04.5-desktop-amd64.iso</span><br><span class="line">    loopback loop ($ntfs_part)$isofile</span><br><span class="line">    linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile quiet splash</span><br><span class="line">    initrd (loop)/casper/initrd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menuentry &quot;Ubuntu 16.04.7 LTS (Xenial Xerus)&quot; --class=ubuntu &#123;</span><br><span class="line">    set isofile=/iso/Linux/ubuntu-16.04.7-desktop-amd64.iso</span><br><span class="line">    loopback loop ($ntfs_part)$isofile</span><br><span class="line">    linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile quiet splash</span><br><span class="line">    initrd (loop)/casper/initrd</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menuentry &quot;Linux Mint 20 (Ulyana) Cinnamon&quot; --class=mint &#123;</span><br><span class="line">    set isofile=/iso/Linux/linuxmint-20-cinnamon-64bit.iso</span><br><span class="line">    loopback loop ($ntfs_part)$isofile</span><br><span class="line">    linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile noprompt noeject quiet splash</span><br><span class="line">    initrd (loop)/casper/initrd.lz</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menuentry &quot;Deepin 20 Beta&quot; --class=deepin &#123;</span><br><span class="line">    set isofile=/iso/Linux/deepin-20Beta-desktop-amd64.iso </span><br><span class="line">    loopback loop ($ntfs_part)$isofile</span><br><span class="line">    linux (loop)/live/vmlinuz.efi boot=live union=overlay live-installer findiso=$isofile locales=zh_CN.UTF-8 quiet splash</span><br><span class="line">    initrd (loop)/live/initrd.lz</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menuentry &quot;Arch Linux x86_64 (2020.08.01)&quot; --class=arch &#123;</span><br><span class="line">	set isofile=&#x27;/iso/Linux/archlinux-2020.08.01-x86_64.iso&#x27;</span><br><span class="line">    set imgdevpath=&quot;/dev/disk/by-uuid/$ntfs_uuid&quot;</span><br><span class="line">	loopback loop ($ntfs_part)$isofile</span><br><span class="line">	linux (loop)/arch/boot/x86_64/vmlinuz-linux img_dev=$imgdevpath img_loop=$isofile earlymodules=loop</span><br><span class="line">	initrd (loop)/arch/boot/intel-ucode.img (loop)/arch/boot/amd-ucode.img (loop)/arch/boot/x86_64/archiso.img</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menuentry &quot;Manjaro 20.0.3 xfce (200606-linux56)&quot; --class=manjaro &#123;</span><br><span class="line">	set isofile=&#x27;/iso/Linux/manjaro-xfce-20.0.3-200606-linux56.iso&#x27;</span><br><span class="line">    set imgdevpath=&quot;/dev/disk/by-uuid/$ntfs_uuid&quot;</span><br><span class="line">	loopback loop ($ntfs_part)$isofile</span><br><span class="line">	linux (loop)/boot/vmlinuz-x86_64 img_dev=$imgdevpath img_loop=$isofile earlymodules=loop</span><br><span class="line">	initrd (loop)/boot/intel_ucode.img (loop)/boot/amd_ucode.img (loop)/boot/initramfs-x86_64.img</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menuentry &quot;GParted Live 1.1.0-5 64-bit&quot; --class=utils &#123;</span><br><span class="line">    set isofile=/iso/Utils/gparted-live-1.1.0-5-amd64.iso </span><br><span class="line">    loopback loop ($ntfs_part)$isofile</span><br><span class="line">    linux (loop)/live/vmlinuz boot=live union=overlay username=user config noswap noprompt ip=net.ifnames=0 toram=filesystem.squashfs nosplash findiso=$&#123;isofile&#125;</span><br><span class="line">    initrd (loop)/live/initrd.img</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menuentry &quot;Clonezilla Live 2.6.7-28 64-bit&quot; --class=utils &#123;</span><br><span class="line">    set isofile=/iso/Utils/clonezilla-live-2.6.7-28-amd64.iso</span><br><span class="line">    loopback loop ($ntfs_part)$isofile</span><br><span class="line">    linux (loop)/live/vmlinuz boot=live union=overlay username=user config noswap noprompt ip=net.ifnames=0 toram=filesystem.squashfs nosplash findiso=$&#123;isofile&#125;</span><br><span class="line">    initrd &#x27;(loop)/live/initrd.img&#x27;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">if [ $&#123;grub_platform&#125; == &quot;efi&quot; ]; then</span><br><span class="line">	menuentry &quot;UEFI firmware setup&quot; &#123;</span><br><span class="line">		fwsetup</span><br><span class="line">	&#125;</span><br><span class="line">fi</span><br><span class="line"></span><br><span class="line">menuentry &quot;Reboot&quot; --class=reboot &#123;</span><br><span class="line">    reboot</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">menuentry &quot;Shutdown&quot; --class=halt &#123;</span><br><span class="line">    halt</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="小结"><a class="markdownIt-Anchor" href="#小结"></a> 小结</h1>
<p>自己折腾一轮之后，还是学到了不少grub相关的知识。虽然说网上也有现成的，但是抄过来还是容易出现各种各样的小毛病，最后还是回过头去翻英文的Wiki和Manual。话说回来，Windows安装盘不清楚能不能跟WinPE一样引导，不过应该也没有这个需求，因为可以直接在WinPE里头挂载Windows iso进行安装。反正我现在全都引导都丢给无敌的grub2处理，以后安装Linux和Windows再也不用反复烧录了，而且替换新版本的iso文件也特别容易。</p>
<p>参考文章：</p>
<ul>
<li><a target="_blank" rel="noopener" href="https://my.oschina.net/abcfy2/blog/491140">[grub实现]U盘引导多个linux镜像安装,同时支持BIOS和UEFI模式 - Feng_Yu的个人空间 - OSCHINA</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/74574207">基于Grub2的winpe+linux多引导启动U盘制作 - 知乎</a></li>
<li><a target="_blank" rel="noopener" href="https://zhuanlan.zhihu.com/p/36467236">grub2 直接启动 ubuntu，fedora，manjaro的live iso样例 - 知乎</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/GRUB_(%E7%AE%80%E4%BD%93%E4%B8%AD%E6%96%87)">GRUB (简体中文) - ArchWiki</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/Multiboot_USB_drive">Multiboot USB drive - ArchWiki</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/Persistent_block_device_naming#by-uuid">Persistent block device naming - ArchWiki</a></li>
<li><a target="_blank" rel="noopener" href="https://wiki.archlinux.org/index.php/GRUB/Tips_and_tricks">GRUB/Tips and tricks - ArchWiki</a></li>
<li><a target="_blank" rel="noopener" href="https://www.gnu.org/software/grub/manual/grub/grub.html">GNU GRUB Manual 2.04</a></li>
<li><a target="_blank" rel="noopener" href="https://help.ubuntu.com/community/Grub2/ISOBoot/Examples">Grub2/ISOBoot/Examples - Community Help Wiki</a></li>
</ul>
<h1 id="最后的最后"><a class="markdownIt-Anchor" href="#最后的最后"></a> 最后的最后</h1>
<p>研究完才发现有个叫<a target="_blank" rel="noopener" href="https://github.com/ventoy/Ventoy">Ventoy</a>的开源项目，也是基于grub2的，而且似乎是动态生成menuentry。。。</p>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/Linux/" rel="tag"># Linux</a>
              <a href="/tags/grub2/" rel="tag"># grub2</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/tech/hexo-customize.html" rel="prev" title="Hexo博客个性化配置">
                  <i class="fa fa-angle-left"></i> Hexo博客个性化配置
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/tech/genshin-direct-download.html" rel="next" title="提取原神下载直链">
                  提取原神下载直链 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2020 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-terminal"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">oscarcx123</span>
        <span class="post-meta-item">
          <span class="post-meta-item-icon">
            <i class="fa fa-chart-line"></i>
          </span>
          <span title="站点总字数">268k</span>
        </span>
        <span class="post-meta-item">
          <span class="post-meta-item-icon">
            <i class="fa fa-coffee"></i>
          </span>
          <span title="站点阅读时长">14:53</span>
        </span>
  </div>
  <div class="powered-by">
    <span class="post-meta-item">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> v6.3.0 强力驱动
    </span>
    <span class="post-meta-item"> 主题 – <a href="https://theme-next.js.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v8.18.1
    </span>
  </div>

    </div>
  </footer>

  
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script size="300" alpha="0.6" zIndex="-1" src="/js/ribbon.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.0.8/medium-zoom.min.js" integrity="sha256-7PhEpEWEW0XXQ0k6kQrPKwuoIomz8R8IYyuU1Qew4P8=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  






  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" integrity="sha256-3574TpfThVfeAhg+I4+N39EJiLN3QUkuEsMVe8hWAR4=" crossorigin="anonymous">
  <script class="next-config" data-name="katex" type="application/json">{"copy_tex_js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/contrib/copy-tex.min.js","integrity":"sha256-Us54+rSGDSTvIhKKUs4kygE2ipA0RXpWWh0/zLqw3bs="}}</script>
  <script src="/js/third-party/math/katex.js"></script>


<script type="text/javascript">
  // 显示“展开”和“折叠”
  function collapsableTitle(x) {
    var nav = document.getElementsByClassName("sidebar-nav-toc")[0];
    if (x.matches) { // If media query matches
      var content = document.getElementsByClassName("sidebar-panel-container")[0];
      if (content.style.display = "none") {
        nav.textContent = "文章目录 [展开]";
      }
      else {
        nav.textContent = "文章目录 [折叠]";
      }
    } 
    else {
      nav.textContent = "文章目录";
    }
  }

  var x = window.matchMedia("(max-width: 991px)"); // media query
  collapsableTitle(x);
  x.addListener(collapsableTitle);

  // 控制目录的折叠
  var tos = document.getElementsByClassName("sidebar-nav")[0];
  var i;

  tos.addEventListener("click", function() {
    this.classList.toggle("active");
    var content = document.getElementsByClassName("sidebar-panel-container")[0];
    var nav = document.getElementsByClassName("sidebar-nav-toc")[0];
    if (content.style.display === "block" && window.innerWidth < 991) {
      content.style.display = "none";
      nav.textContent = "文章目录 [展开]";
    } else {
      content.style.display = "block";
      if (window.innerWidth < 991) {
        nav.textContent = "文章目录 [折叠]";
      }
    }
  });

  // 因为启用pjax，需要监听complete事件，来实现默认折叠效果
  document.addEventListener('pjax:complete', function() {
    if (window.innerWidth < 991) {
      let content = document.getElementsByClassName("sidebar-panel-container")[0];
      content.style.display = "none";
      let nav = document.getElementsByClassName("sidebar-nav-toc")[0];
      nav.textContent = "文章目录 [展开]";
      }
    });
  </script>
</body>
</html>
